% TODO to finish this paper;
% X - Make sure latest (2019.03) 3D printed parts work as written.
% X - Come up with an alignment procedure that always works (e.g. by adjusting
% X - feeder rotation to account for imperfections in bundle location)
% X - Update figures with new parts
% X - Update usage and figures to match the enumerations in captions
% X - Put alignment jig in features figure somehow
% X - Show the clip flip and final magnet location in the tt making steps figure
% X - Produce tts with the up to date 3d components and create the tt characteristics figure
% X - Potentially address these concerns:
% X  - It might make sense to break down how you get to 100 TWP per hour, and to
% X    discuss how much time each part takes: 1) dispensing wire, 2) twisting wire 3)
% X    annealing wire, 3) separating and cutting the leads to the correct length.
% X  - Maybe time an expert user?
% X - Fix Fig. Usage B5.
% X - Update BOMS to match google sheet
% X - Remeasure the leaf spring constant
% X - Try new alignment parts
% X - Assuming alignment works, put in the figures where required
% X - Find the correct clip coating material
% X - Finish tetrode-param table (has XX in table and caption).
% ? - Add the wire retainers onto the feeder assembly on Fig. 6 and elsewhere
% X - Add thumb screw to the bobbin assembly (steps 4-6) on Fig. 6 and elsewhere.
% X - Add relevant open source projects from the stimjim paper to the closing
%   sentences of discussion
% X - Finish addressing Ming's comments on figures
% X - Make sure the rat and mouse CA1 recordings are addressed in the text
%   somewhere
%
% X  - Video of bobbin loading and TT making. This goes on youtube and link in appendix
%
% X - Ming and Jakob proof read
%
%   - Bioarxiv
%
%   - Tweet:
%   1. Here is my work with @jvoigts, @OpenEphys, and @SpikeGadgets on an open
%   source, cheap, and fast tetrode making machine (link). We have been using
%   it in the Wilson and Harnett labs for the past 2 years. It allows you to
%   make probes quickly and reliably. Some features: (1/6)
%       >> twitter_banner.png
%   2. No wire folding! just draw wire it from pre-loaded bobbins. (2/6)
%        >> pull.mov
%   3. Auto-aligning, magnetic wire bundle retention mechanism results in
%   perfectly straight probes every time. (3/6)
%        >> pull_clip.mov
%   4. A 3D-printed leaf spring provides constant wire tension during twisting
%   so you can turn as fast as you want. We use 1000 RPM. Your tetrode
%   is done in seconds. (5/6)
%        >> pull_clip.mov
%   5. New users make about 70 tetrodes an hour.
%        >> start_to_finish.mov
%   6. We are gauging interest for distribution on the Open Ephys store. Please
%   fill out this form if you think you might want one (link). Of course, the
%   bill of materials construction steps are included in the manuscript if you
%   just want to make your own! (6/6)

\documentclass[11pt,a4paper]{article}

%\usepackage{draftwatermark}
\usepackage{booktabs}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[margin=2cm]{geometry}
\usepackage{lineno}
\usepackage{booktabs}
\usepackage{array}
\usepackage[labelfont=bf, font=small]{caption}
\usepackage[onehalfspacing]{setspace}
\usepackage{floatrow}
\usepackage{xr}
\usepackage{siunitx}
\usepackage{enumitem}
\usepackage{wasysym}
\usepackage{siunitx}
\usepackage{placeins}
\usepackage{authblk}
\usepackage[title]{appendix}
\usepackage{array}
\usepackage{siunitx}

%\SetWatermarkText{Draft}
%\SetWatermarkScale{4.5}
%\SetWatermarkHorCenter{200pt}
%\SetWatermarkLightness{0.85}

\DeclareFloatFont{small}{\scriptsize} % "scriptsize" is defined by floatrow
\floatsetup[table]{font=small}
\linenumbers{}
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}

\title{\vspace{-1.5cm} Twister3: a simple and fast microwire twister}

\author[1,2,5]{Jonathan P. Newman \thanks{jpnewman@mit.edu}}
\author[1,3,5]{Jakob Voigts}
\author[4]{Maxim Borius}
\author[4]{Mattias Karlsson}
\author[1,3]{Mark T. Harnett}
\author[1,2,5]{Matthew A. Wilson}

\affil[1]{Department of Brain and Cognitive Sciences, MIT, Cambridge, MA, USA.}
\affil[2]{Picower Institute for Learning and Memory, MIT, Cambridge, MA, USA.}
\affil[3]{McGovern Institute for Brain Research, MIT, Cambridge, MA, USA.}
\affil[4]{SpikeGadgets LLC, San Francisco, CA, USA}
\affil[5]{Open Ephys Inc, Cambridge, MA, USA}

\begin{document}

\maketitle

\begin{abstract}
    \noindent
    We present Twister3, a microwire twisting machine. This device greatly
    increases the speed and repeatability of constructing twisted microwire
    neural probes (e.g.\ stereotrodes and tetrodes) compared to existing
    options. It is cheap, well documented, and all associated designs and
    source code are open-source. Twister3 is of interest to any lab performing
    twisted microwire neural recordings, for example, using tetrode drives.
\end{abstract}

\tableofcontents

\section{Introduction}
Since their introduction~\cite{McNaughton1983}, twisted wire probes (TWPs; e.g
stereotrodes~\cite{McNaughton1983} and tetrodes~\cite{Wilson1993, Wilson1994a})
have been a reliable method for obtaining single-unit extracellular spiking
data in freely moving animals. They are cheap ($\sim$5--10 USD/m using Sandvik
PX000004), small enough to cause minimal inflammation, and sufficiently
biocompatible to be used over many months~\cite{Dhawale2017, Voigts2013}. Their
contacts are close ($\sim$10--20 $\mu$m) and therefore allow much improved unit
separability compared to single wire probes~\cite{Gray1995}. They are
mechanically flexible, such that they move with neural tissue, rather than
behaving like a rigid, skull-coupled beam. This mitigates
``drift''~\cite{Rossant2016,Pachitariu2016} and improves long term stability
compared to with low-density silicon probes\footnote{e.g.
\url{http://neuronexus.com/products/neural-probes/}}, allowing units to be
tracked continuously over multi-day timescales~\cite{Dhawale2017}. Although the
introduction of modern silicon~\cite{Du2011,Jun2017} and carbon-fiber
probes~\cite{Gillis2018} offer major advances in terms of channel density and
size, respectively, and rival microwires in terms of mechanical
flexibility~\cite{Jun2017}, TWPs will remain a ubiquitous recording method for
the foreseeable future due to their simplicity, good performance, and low cost.

Although simple to make~\cite{Nguyen2009}, constructing TWPs is a tedious and
time-consuming process. For modern, easy-to-assemble microdrive
designs~\cite{Voigts2013}, making TWPs is a rate-limiting step. Typically, TWPs
are made in three actions~\cite{Nguyen2009}:

\begin{enumerate}
    \item \textbf{Folding}: insulated tungsten or nickel-chrome (`nichrome')
        resistance wire is drawn from a spool and folded by hand 1 or 2 times
        to make stereo- or tetrodes, respectively.
    \item \textbf{Twisting}: the folded wire is draped over a smooth metal rod.
        The free end of the wire bundle is loosely coupled to a motor armature
        using a mechanical\footnote{\url{http://www.open-ephys.org/twister}} or
        magnetic\footnote{\url{https://neuralynx.com/hardware/tetrode-spinner-2.0}}
        mechanism. The motor then twists the wire bundle into a helix.
    \item \textbf{Fusing}: A hot air gun is used to fuse the insulation
        on the wire helix, forming a springy, implantable probe.
\end{enumerate}

Recently,
SpikeGadgets\footnote{\url{http://www.spikegadgets.com/main/home.html}; Note:
M.K. is co-owner and M.B. is an employee.} introduced a tetrode twisting
machine that provides an arrangement of four pre-wound wire bobbins that allows
the user to draw a multi-wire bundle without the folding
step\footnote{\url{http://www.spikegadgets.com/hardware/tetmachine.html}}.
Because folding is the most time consuming part of the TWP making process,
this device greatly improves the speed at which TWPs can be created.
Additionally, this method minimizes human wire handling, which is beneficial
because wire ends up in direct contact with neural tissue and is difficult to
clean. Despite these advantages, the high-price of its custom-designed
components ($\sim$10,000 USD) and complexity of this device has hampered its
adoption. Inspired by the SpikeGadgets design, we collaborated to create an
open-source twisting machine that is approximately ten times cheaper and ten times faster
(Fig.~\ref{f:design-features} (A)). Our device uses a high-speed stepping motor
and modern micro-stepping driver to increase twisting speed while maintaining
precise control of motor acceleration and smooth motor actuation. A new
counter-balanced, auto-aligning spring system provides constant tension on
tetrode wire during twisting. Our design allows a moderately trained ($\sim$1
hr of experience with device) operator to make $\sim$70 TWPs per hour.

\begin{figure}
\centering \includegraphics{./fig/design-features.png}
\caption{\textbf{(A)} Overview of Twister3's mechanical components. The
    motor and wire feeder assemblies are used to rapidly construct TWPs by
    drawing a wire bundle from the feeder, clipping it to the motor, and
    performing a twist. Additionally, the motor, wire guide, and stock spool
    assemblies are used to load wire onto the bobbins in the feeder after they
    are depleted.
    \textbf{(B)} Motor assembly. A NEMA-17 stepper motor is used to twist TWPs
    and reload bobbins. The wire clip, alignment jig, and magnet allow the wire
    bundle to be rapidly and reliably linked to the motor. The rotor base and
    adjustment plate allow one-time adjustment to achieve perfect alignment
    between the wire bundle and the motor axis.
    \textbf{(C)} \textit{(left)} The 3D printed leaf spring showing deformation
    under tension. The shape of the spring permits approximately vertical
    deformation of the wire attachment point so that the center axis is
    maintained as the bundle is shorted due to twisting. \textit{(right)}
    Spring tension as a function of vertical deformation. Best fit line
    indicates a spring constant of 32 nM/mm. The white dot indicates the spring deformation
    needed to oppose the wire-feeder's stiction setting for TWPs made in our lab.
    \textbf{(D)} \textit{(left)} Wire quick draw mechanism. \textit{(right)} Isolated
    single bobbin indicating the wire tension, due to the leaf spring in (C),
    and counter stiction due to the adjustable torsional spring.}
\label{f:design-features}
\end{figure}

%TODO: The procedure is: 1) manually lft spring beyond this point, 2) attach TWP
%bundle and clip 3) release spring, this evenly pulls the TWB bundle down to the
%point where the spring force counteracts the bobbin stiction.

Here we present descriptions of how this device works, materials and assembly
information, and electronics designs. We provide detailed usage
instructions, an exploration of probe mechanics with respect to twisting
parameters, TWP construction time measurements, and show data obtained with
tetrodes made using this machine. All designs and source code associated with
this project can be found on the Twister3 git
repository\footnote{\url{https://github.com/jonnew/twister3}}.

\section{Notable Design Elements}

\subsection{3D-printed Leaf Spring for Fast Twisting}
In order to achieve straight TWPs, wire must be twisted together while under
tension. In all other existing designs, a weight is hung from the wire bundle
and a motor is loosely coupled to the weight in a way that does not constrain
axial motion. This provides constant tension on the wire bundle due to gravity
while allowing the helix to decrease in length as it is twisted. A variant of
this method uses magnets hold the weight in
place\footnote{\url{https://neuralynx.com/hardware/tetrode-spinner-2.0}}, but,
in our experience, this is unnecessary and is prone to causing wire breakage
due to the nonlinear force/distance relationship of magnetic attraction.

A key design criterion for our device is that TWPs need to be turned very
quickly. We aimed for <10 seconds of twisting time (time when motor is in
motion) per TWP.\@ Assuming 100 total revolutions (upper estimate for tetrodes)
this translates to an average turn rate of 600 RPM.\@ Because previous methods
rely on loose motor coupling, they were unsuitable to meet our speed
requirements. The high centripetal forces involved in rapid turning inevitably
leads to instability of the coupling mechanism, causing the bundle to vibrate
wildly. Therefore, we sought to rigidly constrain the motor and wire
bundle in the turning plane, but still maintain freedom in the axial direction
to allow bundle tensioning and shortening during the turning process. To meet
this goal, we made use of selective laser-sintered polyether block amide (PEBA)
to create a monolithic, combined leaf spring/wire-retention mechanism
(Fig.~\ref{f:design-features} (B)). PEBA provides rubber-like mechanical
qualities resulting in a spring-constant low enough for use with tetrode wire
($\sim$32 mN/mm in the relevant range of motion (Fig.~\ref{f:design-features}
(C)).

\subsection{Auto-aligning Wire/Motor Interface}
To interface the microwire bundle with the motor, the bundle is clipped
together using a standard, ferrous alligator clip that has been coated in
insulating shrink wrap. The bundle is then drawn towards the motor while the
leaf spring is lifted with with the user's free hand. While the leaf spring is
under tension, the alligator clip is attached to a strong neodymium magnet on
the leaf spring assembly, which provides the bundle-to-motor linkage
(Fig.~\ref{f:design-features} (A, B)). During this process, a 3D-printed
alignment jig on top of the magnet automatically guides the microwire bundle
in line with the motor's axis of rotation. The leaf spring is then slowly
lowered until it reaches equilibrium with upward wire tension. At this point
the motor can be turned.

Because of print tolerances and the fact that the leaf spring does not deform
exactly vertically, the resting position of wire bundle will likely not be
perfectly co-linear with the motor axle. To account for this, the motor mount
consists of a two pieces: the base, which is rigidly concentric with the motor
shaft, and an alignment plate. The alignment plate is friction fitted within
the base and provides $\sim$2 mm of omnidirectional planar adjustment
(Fig.~\ref{f:design-features} (B)). This plate should be moved until the
resting position of the wire bundle is in line with the motor axis.

This wire attachment mechanism has two advantages over existing designs. First
it can be used rapidly because of magnetic coupling. Second, because the
microwire bundle is automatically aligned with the motor's axis of rotation,
high-turn rates do not result in oscillations or instability. We have found
that this is a critical feature in order to produce straight, even-pitch, and
consistent TWPs using very fast turn speeds.

\subsection{Quick-draw Wire Feeder}
To further increase the speed at which TWPs can be made, microwire needs to be
drawn and attached to the motor quickly. Ideally, this process should occur
with as few separate actions being taken by the operator as possible. To
facilitate the rapid draw of wire from stock spools, we designed a torsion
spring-based feeding assembly that allows wire to be quickly drawn from stock
feeder bobbins (Fig.~\ref{f:design-features} (C)). This mechanism applies
enough friction to feeder bobbins to counter increased wire tension during a
twist, transferring all slack compensation to the leaf spring
(Fig.~\ref{f:design-features} (B)). The holding (stiction) force of this
mechanism is adjustable to account for the elastic deformation of different
wire materials. We have found that, when working with standard tetrode
wire\footnote{Polyimide-coated nichrome; \diameter12.7$\mu$m}, the 2nd stiction
setting (corresponding to a threshold of $\sim$11.5 N per spool), is adequate
to counter wire tension and therefore prevent spools from improperly feeding
during a twist. However, the proper stiction setting is dependent on the
microwire material and will need to be adjusted for other wire types.

\subsection{Motor Control Hardware for Smooth Turning}
To obtain precise control over motor acceleration, speed, and position we
to used a bipolar stepper motor to perform wire twisting. We have found that,
due to their discretized motion, stepper motors can vibrate resonantly with
taut microwire, resulting in irregular twists and wire damage. To overcome
this issue, we drive our motor using an advanced microstepping driver
(Fig.~\ref{f:ctrl-box} (A));
\href{https://www.trinamic.com/products/integrated-circuits/details/tmc2100/}{Trinamic
TMC2130}). In our case, we use 200 steps/revolution (\ang{1.8})
motor. Microstep commands from the microcontroller are provided at 16
microsteps/step, which are further interpolated to 256 microsteps/step by
internal driver circuitry. This results in a motor update resolution of 3,200
microsteps/revolution (\ang{0.113}), and a motion discretization of 51,200
steps/revolution (\ang{0.007}). Therefore, the motor operates approximately as
smoothly as a continuous DC motor but with much improved motion control
dynamics.

\begin{figure}
\centering
\includegraphics{./fig/electronics-blocks.png}
\caption{\textbf{(A)} Control electronics block diagram. All user IO is
    provided via a combined rotary encoder and button. The Teensy's NXP
    MK20DX256VLH7 microcontroller provides a  programmable interrupt timer
    (PIT) to control step commands to the motor driver, independent of nominal
    operation.
    \textbf{(B)} Control box with callouts showing features, connections, and
    controls.}
\label{f:ctrl-box}
\end{figure}

We used an Arduino-compatible Teensy
3.2\footnote{\url{https://www.pjrc.com/teensy/teensyLC.html}} microcontroller
module to perform step timing calculation. Its NXP MK20DX256VLH7 Cortex-M4
includes an integrated programmable interrupt timer (PIT) which is used to
provide jitter-free step commands to the motor driver while acceleration
calculations are
performed\footnote{\url{https://github.com/luni64/TeensyStep}}.

\section{Usage}
The following sections provided detailed instructions for using Twister3 to
load wire and make TWPs. This content is aided by an instructional video
available on YouTube (Appendix~\ref{s:videos}).

\subsection{Using the Control Box}
The control box (Fig.~\ref{f:ctrl-box} (B)) is powered using a 12V DC
center-positive barrel jack that supplies at least 1.5A. It has a single user
input: a control knob consisting of a combined quadrature rotary encoder and
tactile push-button. This knob permits the following user actions:

\begin{itemize}[noitemsep]
    \item \textbf{Press:} cycle through different settings (forward turns,
        backward turns, turn speed, turning mode)
    \item \textbf{Turn:} increment or decrement the selected setting
        depending on turn direction.
    \item \textbf{Press and hold:} execute the turn sequence using the
        current settings
    \item \textbf{Press during motion:} cancel the twist and stop the motor
        immediately.
\end{itemize}

The control box is used to perform two tasks: twisting electrodes (turn mode 0)
and loading bobbins with microwire (turn mode 1). The turn mode is selected and
changed using the dial on the controller. The selected turn mode is shown in
the upper right corner of the liquid crystal display (LCD). After a mode is
selected, all turning parameters (speed, forward and backwards turns) pertain
to that mode only. All parameters are stored in non-volatile memory when a turn
is started by pressing and holding the control knob. In the following sections,
we detail how to use the mechanical components for making TWPs and loading
bobbins with stock wire.

\subsection{Loading Bobbins}
Before twisting electrodes, the bobbins on the wire feeder assembly must be
loaded with microwire (Fig.~\ref{f:usage}A). The following steps detail the
bobbin loading procedure:
\begin{enumerate}[noitemsep]
    \item Remove the wire shield by removing its M6-retention screw.
    \item Remove one set of bobbins by unscrewing the M3 bolt that serves as
        the axle.
    \item Take the bobbins and spacers off the axle.
    \item Remove any remaining microwire from each bobbin and ensure they
        are clean of dirt and debris.
    \item Remove the leaf spring to the base rotor.
    \item Place a bobbin on the motor using the embedded magnets
        (Fig.~\ref{f:usage} (A1))
    \item Adjust the position of the wire guide such that the tip points
        directly into the center of the wire groove on the bobbin. The tip of
        the wire guide should be a few millimeters away from this groove
        (Fig.~\ref{f:usage} (A1)).
    \item Feed the tetrode wire from the stock spool through the wire guide and
        wrap once around the bobbin in its center groove
        (Fig.~\ref{f:usage} (A2)).
    \item Set the controller to ``mode 1''.
    \item Select the desired loading speed. We have found that 100 RPM works
        well for our wire.
    \item Select the desired number of turns to load the bobbin. The
        circumference of the bobbin is $\sim$10 cm. The length of wire loaded
        on the bobbin is therefore $turns \times 10\ cm$. Including wastage,
        this results in a conservative estimate of 1 TWP per turn
        (Table~\ref{t:tetrode-param}).
    \item Start the turn and wait until it is finished. \textit{Be careful not
        touch moving parts during this process}: the microwire needs to have
        constant tension to ensure it is properly loaded on the bobbin.
    \item Repeat the process for the remaining bobbins.
    \item Put the bobbins back on their axle on the wire feeder assembly. Loose
        wire ends should point inward on both sides of the assembly.
    \item Replace the wire shield.
\end{enumerate}

Properly loaded bobbins will have microwire tightly wound around their center
groove. This relies on carefully adjusting the position of the wire guide such
that it's tip is located about 1--2 mm from the center groove. The loading
processes should be monitored as it begins to ensure that microwire is being
accepted by the bobbin. If there is an issue, pressing the knob on the
control unit will halt the process so it can be corrected.

\begin{figure}
\centering
\includegraphics{./fig/usage.png}
\caption{\textbf{(A)} Bobbin loading procedure. \textbf{(B)} TWP construction
procedure. See text for details.}
\label{f:usage}
\end{figure}

\subsection{Making Twisted Wire Probes}
The following steps detail tetrode construction using Twister3. If you are
interested in making stereotrodes instead of tetrodes, follow the same steps but
only use two bobbins on opposing sides of the feeder.

\begin{enumerate}[noitemsep]
    \item Attach the leaf spring to the base rotor (Fig.~\ref{f:usage} (B1))
    \item Draw the wire down from all of the bobbins and group the tips with
        your fingers. If one wire is much longer than the others, trim it.
    \item Clamp the tip of bundle with the alligator clip. The position of the
        wire bundle in the clip is not important (Fig.~\ref{f:usage} (B2)).
    \item Flip the clip 180$^{\circ}$ such that the wire bundle wraps around the
        bottom of the clip and exits its rear face (Fig.~\ref{f:usage} (B3,
        inset)). This will ensure that the wire does not slip and that the
        twist alignment jig will keep the bundle exactly concentric with the
        axis of rotation during twisting.  Keep the clip in your hand while
        performing the following 2 steps.
    \item With your free hand, pull up on the twisting attachment's leaf spring
        until under slight tension, about 1.5 cm (Fig.~\ref{f:usage} (B3)).
    \item Draw the alligator clip down to meet the magnet on the twisting
        attachment, feeding the bundle into the alignment jig
        (Fig.~\ref{f:usage} (B4)). The alligator clip can be rotated before
        drawing to wrap the wire around it and improve its grip on the bundle.
    \item Ensure all wires are guided through the center of the alignment jig
        (Fig.~\ref{f:usage} (B4, inset)) and the loose ends are not interfering
        with the taught portion of the wire.
    \item Slowly lower the leaf spring until it is in equilibrium with the
        upward force produced by the tetrode wire. Each of the wires should be
        pulled straight. If any wire has slack, its bobbin can be turned
        backwards slightly until it is taut. Do not let the spring snap back
        under its tension, as this will leave slack in the wires
    \item Set the controller to ``mode 0''. Set the desired number of turns and
        turn speed. We use 900 RRM for our wire. This only needs to be done
        once, or whenever parameter changes are required.
    \item Press and hold the knob down to perform a twist.
    \item When finished, fuse wires \textit{starting from point at which they
        separate towards the bobbins} using the hot air gun at
        $\sim$\SI{480}{\celsius} (Fig.~\ref{f:usage} (B5)). We have found that
        fusing from the bottom will cause the lower portion of the TWP to
        `absorb' slack from above resulting in a very fine twist pitch and a
        TWP that is shorter than intended.
    \item Using two hands, simultaneously roll each of the bobbins forward a
        bit in order to release tension on the tetrode wire (Fig.~\ref{f:usage}
        (B6))
    \item Cut the tetrode wire above the point at which the wires are fused
        (Fig.~\ref{f:usage} (B7)). Make sure to leave enough free wire for
        connectorization.
    \item Pull the alligator clip off the magnet and cut the finished tetrode
        into a storage box (Fig.~\ref{f:usage} (B8)).
\end{enumerate}

Choosing twisting parameters will require some experimentation in order to
produce TWPs with the desired geometric and mechanical properties given the
user's choice of wire, implant type, and animal model. In our labs, we use
Twister3 to make tetrodes for microdrive implants in both mice and rats. The
operation settings that we use are shown in Table~\ref{t:tetrode-param}.  Two
settings of note are the height of the wire feeder above the motor assembly,
which determines the probe length and microwire twist pitch and the bobbin
stiction threshold which determines the wire tension during twisting and
drawing.  Figure~\ref{f:trode-char} shows the effect of changing the wire
feeder height on resulting tetrode characteristics. Although lowering the
feeder closer to the motor, and therefore increasing the angle of wire
divergence from the axis of rotation does decrease twist pitch and probe length
for a given number of turns, the buckling point (Fig.~\ref{f:trode-char}) and
stiffness (Fig.~\ref{f:trode-char}) of tetrodes across feeder heights are
remarkably stable.

To test probe functionality, we produced tetrodes using the device settings in
Table~\ref{t:tetrode-param}. Using procedures that were approved by the
Committee on Animal Care of Massachusetts Institute of Technology and followed
the ethical guidelines of the US National Institutes of Health, these tetrodes
were gold plated~\cite{Nguyen2009} and used in combination with microdrive
assemblies~\cite{Voigts2013,Kloosterman2009} to obtain recordings in the
pyramidal cell layer of CA1 of mice and rats. As expected, these tetrodes
reliably produced characteristic LFP and multiple, well-isolated units in both
mice (Fig.~\ref{f:trode-char}(D)) and rats (Fig.~\ref{f:trode-char}(E)).

\begin{table}[!htbp]

\centering
\caption{Materials, operation parameters, and resulting tetrode features as
    Twister3 is used in our labs. Critical settings are the feeder height,
    which controls the TWP pitch and bobbin torsion, which controls wire
    tension. \small\textsuperscript{*}Using the hot air station specified in
    the bill of materials, this is the lowest setting used in combination with
    8 mm diameter nozzle \small\textsuperscript{$\dagger$}Mean $\pm$ standard
    deviation over three novice users (Fig.~\ref{f:tt-time})
}
\label{t:tetrode-param}

\begin{tabular}{rlP{3cm}P{3cm}}
\toprule
                    &                                           & \textbf{Mouse}   & \textbf{Rat}      \\
\cmidrule{3-4}
\textbf{Materials}  & Microwire                                 & \multicolumn{2}{c}{Sandvik PX000004} \\
                    &                                           & \\
\textbf{Hardware}   & Feeder height                             & \multicolumn{2}{c}{49 cm from base to bobbin axle} \\
\textbf{Settings}   & Bobbin stiction                           & \multicolumn{2}{c}{Set point 2 ($\sim$11.5 mN)} \\
                    & Hot air temp                              & \multicolumn{2}{c}{\SI{480}{\celsius}} \\
                    & Hot air flow\textsuperscript{*}           & \multicolumn{2}{c}{$\sim$5.8 L/m} \\
                    &                                           & \\
\textbf{Turn}       & Forward turns                             & 40               & 60 \\
\textbf{Settings}   & Reverse turns                             & 10               & 15 \\
                    & Turn speed                                & \multicolumn{2}{c}{900 RPM} \\
                    &                                           & \\
\textbf{Results}    & TWP length                                & 37 mm            & 55 mm \\
                    & Twist pitch                               & \multicolumn{2}{c}{1.18 mm} \\
                    & Avg.\ load time\textsuperscript{$\dagger$} & \multicolumn{2}{c}{21.1 $\pm$ 10.0 sec} \\
                    & Turn time                                 & 8 sec           & 9.5 sec \\
                    & Avg.\ fuse time\textsuperscript{$\dagger$} & \multicolumn{2}{c}{11.1 $\pm$ 5.6 sec} \\
                    & Avg.\ cut/removal time\textsuperscript{$\dagger$}  & \multicolumn{2}{c}{11.3 $\pm$ 4.5 sec} \\
                    & Avg.\ TWP time\textsuperscript{$\dagger$}  & 51.5 $\pm$ 9.6 sec &  53.0 $\pm$ 9.6 sec \\

\bottomrule
\end{tabular}
\end{table}

\begin{figure}
\centering
\includegraphics{./fig/tt-mech.png}
\caption{Tetrode characteristics for different twist pitches.
    \textbf{(A)} \textit{(left)} Feeder height versus twist pitch and probe
    length for the tetrodes in this figure. All other construction parameters
    were kept the same as Table~\ref{t:tetrode-param}. Circled row indicates
    the parameters used in the tetrode used to create panel (D).
    \textit{(right)} Diagram of the mechanical test. Tetrodes were attached to a rigid column
    and the exposed portion cut to a length $L$. The rigid column was lowered
    in small increments using a micromanipulator onto a precision scale and the
    restoring force was measured to find the buckling point.
    \textbf{(B)} \textit{(left)} Compressive force versus depth lowered
    ($\delta L$) onto a rigid surface.  Each line is a single tetrode sample
    cut to one of 5 exposed lengths ($L$ = 25, 20, 15, 10, and 5 mm). Data
    point symbols correspond to the table in (A) for various probe lengths.
    The buckling force (value at which there is no increas in restorative force
    with $\delta L$) is length dependent. Different exposed probe lengths form
    clear groupings with the bucking force increasing as the probe length gets
    shorter. \textit{(right)} Buckling forces for each sample on a log scale.
    The buckling force is clearly grouped for each probe length but is not
    affected by twist pitch.
    \textbf{(C)} Stiffness versus probe length for each of the samples tested.
    Of the parameters tested, longer, wide-pitch TWPs tended to be stiffest.
    \textbf{(D)} Example hippocampal mouse CA1 recording during sleep.
    \textit{(top)} Raw voltage trace from a single tetrode. Three sharp
    wave-ripple events are clearly visible in the trace. \textit{(bottom)}
    Spike amplitudes for each combination of two wires on the tetrode.
    \textbf{(E)} Example hippocampal rat CA1 recording during sleep.
    \textit{(top)} Raw voltage trace from a single electrode. Multiple sharp
    wave-ripple events are clearly visible in the trace. \textit{(bottom)}
    Spike amplitudes for each combination of two wires on the tetrode.
    Recordings in (D) and (E) are skull referenced.
}

\label{f:trode-char}
\end{figure}

\subsection{TWP Construction Time}
To quantify Twister3's speed of operation, we measured the tetrode construction
time of three users. All users had $\sim$1 hour of experience with the device
at the time of testing (Fig.~\ref{f:tt-time}). We divided speed measurements
into three steps: \textit{(1)} wire clipping/drawing, \textit{(2)} wire
twisting/fusing, and \textit{(3)} tetrode removal and storage.  Time trials
were performed using the device parameters shown the ``Mouse'' column of
Table~\ref{t:tetrode-param}. The motor-in-motion time was constant (9.1 sec at
1000 RPM max speed) and therefore incurred a constant offset on step (2), as
indicated by the dashed line in Figure~\ref{f:tt-time}. All users were able to
create tetrodes at a pace exceeding 1 tetrode/minute. However, each user had
slightly different strategies when using the device. For instance, user 3, who
has large amounts of experience with tasks requiring fine motor skills, was
relatively quick for steps (1) and (3) and was relatively slow for the fusing
step (2).  User 1 had occasional difficulty clipping and the wire during step
(1), increase their average time. These discrepancies indicate that there is
room for future improvement and automation, especially with respect to wire
clipping and fusing.

\begin{figure}
\centering
\includegraphics{./fig/tt-time-trials.png}
\caption{
    Tetrode construction time of users with $\sim$1 hour of experience with
    Twister3. \textit{(left)} Total construction time for each tetrode
    (symbols), average time across tetrodes for each user (thin lines), and across all tetrodes and users (thick
    line). \textit{(right)} Timing for each step of tetrode construction.
    The dotted line above the turn and fuse step is the constant motor-in-motion
    time. Twister3 parameters were the same as the ``Mouse'' column of
    Table~\ref{t:tetrode-param}.
}
\label{f:tt-time}
\end{figure}

\section{Materials and Assembly}
A potentially updated bill of materials (BOM) for electrical, mechanical and
3D-printed parts is available on a Google
sheet\footnote{\url{https://bit.ly/2H2a4FD}}. Instructions for component assembly are
provided in the following sections. For ease of reference and permanence, we
provide snapshots of current BOMs in Appendix~\ref{s:boms}. However, the online
versions should be used during Twister3 assembly to ensure up to date suppliers
and error corrections.

\subsection{Mechanical Components}
The mechanical portion of Twister3 consists of common hardware, standard
optomechanical components, and 3D-printed parts. Wherever possible, we used
standard (and easy to replace) parts. The mechanical bill of materials is shown
in Table~\ref{t:mech-bom}. In addition to these standard mechanical components,
several 3D-printed parts are required (Table~\ref{t:3d-bom}). These parts are
available for direct purchase from third-party 3D-printing services via the
links provide in the table. After obtaining the required components, the wire
feeder, wire-guide, and stock-spool assemblies can be constructed by following
steps detailed Figures~\ref{f:feeder-assem},~\ref{f:other-assem}
(A),~\ref{f:other-assem} (B), and~\ref{f:other-assem} (C), respectively. After
each of these modules is complete, they are combined into the complete device
by following the steps presented in Figure~\ref{f:twister3-assem}.

\begin{figure}
\centering
\captionsetup{singlelinecheck=off}
\includegraphics{./fig/feeder-assembly.png}
\caption[]{Wire feeder assembly.
\begin{enumerate}[noitemsep]
    \item Insert press-in components into the feeder base. This includes M3 nut
        (2x), M3 standoff (2x), and 3/16'' diameter dowel pin (2x). This
        requires a mallet.
    \item Mount the feeder base unto the C1545/M mounting clamp using M6 screws
        (2x). The top of the feeder should be flush with the mounting clamp.
    \item Cut two 5 cm sections from the M3 threaded rod. Turn each section
        into the M3 nut which behind the feeder base. The position of the rod
        determines the stiction on each bobbin during wire draw. Lower
        positions provide less stiction. We have found that the second notch is a
        good position to start with.
    \item Use the 60 mm M3 screw to mount the bobbin assembly to the standoff
        captive within the feeder base. Repeat for both sides. The thumb-screw
        head should be glued onto the M3 screw using epoxy prior to this step.
    \item Thread a torsional spring onto the dowel pin. Squeeze it together
        and then set it between the threaded rod on one side and the shallow
        groove in each bobbin on the other. Repeat for each bobbin.
    \item Install the wire shield above the bobbins using a single M6 screw.
\end{enumerate}}
\label{f:feeder-assem}
\end{figure}

\begin{figure}
\centering
\captionsetup{singlelinecheck=off}
\includegraphics{./fig/other-assembly.png}
\caption[]{Other mechanical assemblies.

\textbf{(A) Motor assembly.}
\begin{enumerate}[noitemsep]
    \item Remove the long, M3 step screws from the bottom of the stepper motor
        (4x).
    \item Use 40 mm M3 screws (4x) to attach the motor mount to the bottom of
        the motor.
    \item Fix the rotor base onto the shaft with the M3 set screw.
    \item Press fit two magnets into the alignment plate \textit{in the same
        orientation}. Make sure they are pushed down until recessed below the
        plastic surface so that they do not interfere with the flat mating
        surface of the piece.
    \item Insert the alignment plate into the slot on the rotor base.
    \item Attach two \textit{additional} magnets on top of those you just
        inserted into alignment plate. Press the spring rotor onto these
        magnets to press fit them into the spring rotor base. This procedure
        ensures that magnets will be press fit into the spring rotor base with
        the correct polarity.  Make sure the magnets are recessed below the
        bottom surface of the spring rotor so that it rests flat on top of the
        alignment plate.
    \item Push the clip magnet into one of the slots on the spring rotor top.
        In the remaining slot, press the twist alignment jig into position over
        the magnet.
\end{enumerate}

\textbf{(B) Wire clip assembly.}
\begin{enumerate}[noitemsep]
    \item Put two pieces of heat shrink tubing over the wire clip jaws.
    \item Shrink into position using the hot air gun. This prevents electrode
    wire from slipping during a draw.  The clip can then be stuck under the
    wire alignment jig (Fig.~\ref{f:usage}).
\end{enumerate}

\textbf{(C) Wire guide assembly.}
\begin{enumerate}[noitemsep]
    \item Screw the wire-guide into a mini, 6 mm diameter optical post.
    \item Push the optical post into a swivel post holder.
\end{enumerate}

\textbf{(D) Stock spool assembly.}
\begin{enumerate}[noitemsep]
    \item Push a bearing into each of the stock spool bearing cases.
    \item Push each of the bearing cases into the stock spool of tetrode wire.
    \item Push a 40 mm, M3 screw through the two bearings and screw into a mini,
        6 mm diameter optical post.
    \item Push the optical post into a swivel post holder.
\end{enumerate}
}

\label{f:other-assem}
\end{figure}
\FloatBarrier

\begin{figure}
\centering
\captionsetup{singlelinecheck=off}
\includegraphics{./fig/twister3-assembly.png}
\caption[]{Twister3 assembly.
\begin{enumerate}[noitemsep]
    \item Screw together the large, 1.5" diameter mounting posts and then screw
        this long post into either the left or right side of the optical bread
        board. Mount the stock spool assembly in on the opposite side of the
        optical breadboard using a M6 screw. Its exact position does not matter.
    \item Mount the feeder assembly on the post using the post mounting clamp
        on its back.
    \item Mount the rotor assembly directly in front of the post, as close as
        it will go, using 3 M6 screws.
    \item Mount the wire guide assembly into a position that is in close
        proximity to the motor assembly using a single M6 screw. The tip of the
        wire guide should be able to extend into the center grove of a wire bobbin
        when it is mounted on the rotor bases for wire reloading.
    \item With the wire-clip mechanism installed, slide the adjustment plate
        around until the motor axis of rotation (dotted black line) is precisly
        in line with the wire bundle (red lines). When properly aligned, the apex of
        the wire bundle will appear motionless during motor turning.
\end{enumerate}
}
\label{f:twister3-assem}
\end{figure}

\FloatBarrier

\subsection{Control Electronics}
The control board is comprised of the following blocks: power regulation,
motor-driver, microcontroller, and user interface (Fig.~\ref{f:ctrl-box} (A)).
Wherever possible, we used pre-assembled modules (microcontroller, motor
driver, and LCD display). The bill of materials for this board is shown in
Table~\ref{t:elec_bom}. Printed circuit board designs and Gerber files are
available on the Twister3
repository\footnote{\url{https://github.com/jonnew/twister3/tree/master/control-board}}.

\section{Discussion}
There are several device options for making TWPs. These broadly fall into two
categories: \textit{(1)} Twisters with a manual wire folding step, and
\textit{(2)} Pre-loaded bobbin designs. Devices such as the Open Ephys
Twister\footnote{\url{http://www.open-ephys.org/twister}}, Matt Gaidica's
Simple Twister\footnote{\url{http://www.open-ephys.org/simple-twister}}, and
the Neuralynx
Spinner-2.0\footnote{\url{https://neuralynx.com/hardware/tetrode-spinner-2.0}}
fall into the first category. The first of these two devices are very cheap and
simple, and may be ideal for labs who do not need to make many tetrodes and can
accept some TWP construction variability. However, a general disadvantage with manual
folding machines is that they are slow. This is due to a  manual folding step
combined with loose mechanical coupling that requires slow turning speeds.  A
single TWP generally takes several minutes to make, even for an experienced
operator. This can be partially mitigated by using these devices in
parallel: a second TWP is folded while the first is turned. However, we have
found that due to the finicky nature of the folding step, using any more than
two devices at a time is nearly impossible. Further it places a large rote
labor burden on the operator, which can lead to poor construction quality due
to boredom.

Aside from slow construction speed, these devices introduce large (and
uncontrollable) variability in manual wire handling and twist-pitch (which is
directly linked to electrode compliance (Fig.~\ref{f:trode-char})). Although
they are cheaper than bobbin-based designs, their manual labor requirements and
slow operation lead to human-resource requirements that can far outweigh the
increased material cost of bobbin-based designs.

There are two options for pre-loaded bobbin TWP machines: Twister3 and the
SpikeGadgets Tetrode
Machine\footnote{\url{http://www.spikegadgets.com/hardware/tetmachine.html}}.
Although similar in principle of operation, these two designs use different
strategies at nearly every component resulting in very different user
experiences and cost. We have summarized these differences in
Table~\ref{t:compare}.

\setlength{\tabcolsep}{10pt}

\begin{table}[!htbp]
\centering
\caption{Comparison of Twister3 and SpikeGadgets Tetrode Machine.}
\label{t:compare}

\begin{tabular}{rll}
\toprule
&
\textbf{SpikeGadgets} &
\textbf{Twister3} \\
&
\textbf{Tetrode Machine} &
\textbf{(this device)} \\

\cmidrule{2-3}

\textbf{Wire feed mechanism}            & Spring-loaded clamp   & Torsion-spring quick draw  \\
\textbf{Automatic wire fusing}          & Yes                   & No \\
\textbf{Wire/motor-axis alignment}      & No                    & Yes \\
\textbf{TWP turning motor type}         & Continuous DC         & Stepper \\
\textbf{Wire fuser motor type}          & Stepper               & N/A \\
\textbf{Motor controller}               & Standard half-bridge  & TMC2130 \\
\textbf{TWP turning speed}              & 60 RPM typical        & 700--1000 RPM typical \\
\textbf{Acceleration control}           & No                    & Yes \\
\textbf{Bobbin/motor attachment}        & Screw                 & Magnets \\
\textbf{Wire bundle/motor attachment}   & Free-hanging          & Leaf-spring \& magnet \\
\textbf{Microcontroller module}         & Arduino Due           & Teensy LC \\
\textbf{Adjustable twist geometry }     & No                    & Yes \\
\textbf{Mechanical parts}               & Custom machined       & Standard optomechanics \& 3D printed \\
\bottomrule
\end{tabular}
\end{table}

The two most notable differences between Twister3 and the SpikeGadgets Tetrode
Machine are the means by which they increase TWP construction speed and the
wire fusing mechanism. Twister3 provides automatic wire bundle alignment and a
leaf-spring based bundle to motor coupling, instead of relying on gravity to
provide wire tension. This means that wire can be turned at fast
speeds while maintaining twist integrity. Because wire turning only takes a few
seconds, it is not a rate limiting step in the TWP construction process.
Because the SpikeGadgets device lacks Twister3's motor coupling features, it
must turn TWPs relatively slowly ($\sim$60 RPM vs. $\sim$1000 RPM).

To compensate for its slow turn rate, the SpikeGadgets machine permits
efficient construction via parallelization. Wire is turned slowly, but a linear
actuator and hot air gun are used to perform the fusing step automatically. The
benefit of this strategy is twofold: (1) increased repeatability of the fusing
step, and (2) manual labor is only required for clipping the wire bundle
to the motor. This allows 3 identical twisting units to be used in parallel,
increasing the effective TWP construction rate to the point where there is
effectively no user downtime. The downside of this strategy is a major increase
in materials cost and design complexity compared to Twister3. However, given
the additional benefits of automated wire fusing, we see this feature as
obvious target for future improvement of Twister3.

Aside from these two primary differences, Twister3 also affords several other
improvements compared to the SpikeGadgets device. Twister3 provides precise
acceleration control, quick-draw wire feeding, rapid magnetic wire bundle to
motor attachment mechanism, and automatic wire tensioning. These features
simplify operator use in comparison to the SpikeGadgets machine. Further, our
use of standard optomechanical and cheap 3D printed parts greatly reduces BOM
cost and increases ease of acquisition compared to SpikeGadgets design, which
relies on custom, tight-tolerance machined parts.

Because TWPs provide a good balance of data quality, ease of use, ease of
assembly, and low cost, they will continue to be used in \textit{in vivo}
neurophysiology labs for years to come. Twister3 is a simple device that
greatly decreases manual labor, greatly increases TWP production speed and
quality, and is affordable for most labs that might benefit from it. It is
fully open-source, well-documented (via this manuscript and instructional
videos (Appendix~\ref{s:videos})), and is composed of easy to obtain parts.
Further, we encourage the replication and improvement of this device by others.
For instance, an open design that incorporates the automated wire fusing step
would further reduce human variability in TWP quality of the current design. We
hope that Twister3 complements the growing number of open-source
electrophysioloy tools, such as
microdrives~\cite{Kloosterman2009,Voigts2013}, electrical
stimulators~\cite{Cermak2019}, optical
stimulators~\cite{Newman2015}\footnote{\url{https://github.com/jonnew/cyclops}},
acquisition hardware~\cite{Siegle2017}, electrode impedance
testers~\cite{Matsumoto2019}, and software~\cite{Newman2012b, Siegle2017,
Lopes2015}. Combined with a growing ecosystem of open-source hardware, e.g.\
for microscopic imaging~\cite{Cai2016,Voigt2019,MIMMS}, DNA
amplification~\cite{OpenPCR}, audio monitoring~\cite{Hill2018}, culture
plate-reading~\cite{Szymula2019}, bacterial evolution~\cite{Takahashi2015}, and
closed-loop small animal experimentation~\cite{Maia2017,Moreira2019}, these
tools will permit labs to be completely outfitted with high-performance,
low-cost, open-source tools. We believe this trend will increase the
accessibility, transparency, and quality of scientific research in
general~\cite{Siegle2015}.

\section*{Acknowledgements}
The authors gratefully acknowledge Ming-fai Fong for her detailed review of the
manuscript. Additionally, we thank Marie-Sophie Helene van der Goes and Dimitra
Vardalaki for their helpful feedback on the device design as well as
participating in time trial testing. Finally, we thank Hector Penagos for
providing the tetrode recordings from mice and rats presented in
Fig.~\ref{f:trode-char} of this manuscript.

This work was supported by the Center for Brains, Minds and Machines (CBMM),
MIT, funded by NSF STC award CCF-1231216. JPN was supported by the NIH (NRSA
1F32MH107086-01). JV and MTH were supported by funding provided by the NEC
Corporation Fund for Research in Computers and Communications at MIT and the
NIH (1R01NS106031). JV is a Simons Center for the Social Brain at MIT
postdoctoral fellow and MTH is a Klingenstein-Simons Fellow in Neuroscience, a
Vallee Foundation Scholar, and a McKnight Scholar.

\medskip

\bibliographystyle{unsrt}
\bibliography{twister3}

\newpage

\begin{appendices}

\section{Instructional Videos}\label{s:videos}

Videos documenting device operation and usage are available on YouTube:

\begin{itemize}
    \item \textbf{\url{https://youtu.be/xQbXc738ZuM}} Annotated video showing
        how to use Twister3 to load bobbins with electrode wire and how to use
        Twister3 to make tetrodes.
    \item \textbf{\url{https://youtu.be/B0MdM4z-wl0}} Video showing the
        construction of two tetrodes, start to finish.
\end{itemize}

\section{Bills of Materials}\label{s:boms}

\input{mechbom}
\input{3dbom}
\input{elecbom}

\end{appendices}

\end{document}
